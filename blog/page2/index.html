<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title> Cooper's Cloud</title>
	<meta name="description"
		content="Cooper's Cloud">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="stylesheet" href="/cooperlutz.github.io/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/cooperlutz.github.io/assets/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/cooperlutz.github.io/blog/page2/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Cooper's Cloud"
		href="/cooperlutz.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
		integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet"
		type="text/css">
	

	<!-- KaTeX -->
	

	<!-- Google Analytics -->
	
</head>
  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/cooperlutz.github.io/">
			<img class="avatar" src="/cooperlutz.github.io/assets/img/CoopersCloudLogoColor.png" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/cooperlutz.github.io/">Cooper's Cloud</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled  -->
			














<li>
	<a href="https://github.com/cooperlutz/cooperscloud" title="Follow on GitHub">
		<i class="fab fa-fw fa-github"></i>
	</a>
</li>































            <!-- Search bar -->
            
		</ul>
	</nav>

</header>

    <div class="content">
      <div class="home">
  

  <div class="posts">
    
    <div class="post-teaser">
      <header>
        <h1>
          <a class="post-link" href="/cooperlutz.github.io/2018/04/03/mastering-arm-templates-1.html">
            Mastering ARM Templates Episode 1 - The Basics
          </a>
        </h1>
        <p class="meta">
          April 3, 2018
        </p>
      </header>
      <div class="excerpt">
        <h2>Getting Started with ARM Templates</h2>
<p>I’ve spent a considerable amount of time developing ARM Templates and have been working to put together a series of posts to help you master ARM Templates, whether you’re just getting started with Azure or have been developing ARM Templates since their inception. Beyond simplifying your deployments, you can learn so much about Azure’s inner workings and more complex features through ARM Template development.</p>

<p> </p>

<p>ARM Templates are Azure’s built-in infrastructure-as-code (IAC) toolset. This means that I can create or modify resources within Azure (Virtual Machines, Virtual Networks, etc.) by creating a configuration file and letting Azure handle the provisioning. ARM Templates enable you to create consistent and repeatable deployments within your Azure environment.</p>

<p> </p>

<p><img src="/cooperlutz.github.io/assets/img/ARMTemplateDiagram.png" alt="image alt text" /></p>

<p> </p>
<h2>ARM Templates Basics</h2>
<p>ARM Templates are defined using JSON (JavaScript Object Notation), a structured language that consists of data referenced as name/value pairs, stored as objects. Let’s take a look at some of the components that make up an ARM Template (click image to enlarge).</p>

<p> </p>

<p><img src="/cooperlutz.github.io/assets/img/ARMTemplate-Visual.png" alt="image alt text" /></p>

<p> </p>
<h4>ARM Template Resources</h4>
<p>https://github.com/Azure/azure-quickstart-templates</p>

<p>The Azure team has provided a public GitHub repository with a number of reference ARM Templates to get you started. This is where I always start when developing a new template.</p>

<p> </p>
<h4>Development Tools</h4>
<p><strong><a href="https://code.visualstudio.com/">Visual Studio Code</a></strong></p>

<p>VS Code is a light-weight editor that’s perfect for developing ARM Templates. VS Code has built-in integrations with  This is my recommended tool for a large majority of your ARM Templating needs, and one of my favorite features is the ability to auto-format JSON!</p>

<p><img src="/cooperlutz.github.io/assets/img/VSCode_Formatting.png" alt="image alt text" /></p>

<p> </p>

<p><strong><a href="https://www.visualstudio.com/">Visual Studio</a></strong></p>

<p>Visual Studio has built-in auto-formatting and some other great features for helping develop and deploy complex ARM Templates. Using Visual Studio can be overwhelming for getting started but I will provide plenty of information and resources about Visual Studio in the coming weeks.</p>

<p> </p>

<p><strong><a href="http://armviz.io">Armviz.io</a></strong></p>

<p>Armviz is a browser-based ARM Template development tool. Armviz has a fairly decent feature that allows you to generate a design view of the Azure resources inside your template. Big catch for this tool, its a Public project hosted on GitHub that hasn’t been updated in a couple years. I’ll use this tool for quick and simple templates sometimes, but don’t recommend it for every day use.</p>

<p> </p>

<p><strong>Version Control Tools -</strong> <strong><a href="https://github.com/">GitHub</a>, <a href="https://www.visualstudio.com/team-services/">VSTS</a>, <a href="https://bitbucket.org">Bitbucket</a></strong></p>

<p>Using a version control service is the recommended method of storing ARM Template code. If you don’t have much of a development background these tools can take some getting used to, so I wouldn’t worry about them too much when getting started.</p>

<p> </p>
<h4>Deployment Options</h4>
<p><strong>Azure Portal resource deployment</strong> - within Azure you’re able to perform a one-time deployment of an ARM Template by creating a new resource “Template deployment”.</p>

<p><strong>PowerShell</strong> - the AzureRM PowerShell modules have a “New-AzureRMResourceGroupDeployment” command to deploy templates.</p>

<p><strong>Templates Blade</strong> - the Azure Portal has a “Templates” blade that allows you to store your templates within Azure and easily deploy.</p>

<p><strong>Visual Studio</strong> - one of the value propositions for using Visual Studio to develop ARM Templates is the ability to deploy your template directly to Azure.</p>

<p><strong>Deploy to Azure</strong> - azuredeploy.net is a great tool to easily deploy ARM Templates from a <em>public </em>GitHub repository to your Azure environment. Azuredeploy.net cannot be used for Private GH repositories.</p>

<p> </p>
<h2>First ARM Template</h2>
<p>We’ll start with an ARM Template that creates a new VNet with 2 Subnets.</p>

<p>To start, log into Azure and then browse to the following link:</p>

<p><a href="https://github.com/cooperlutz/cooperscloud/tree/master/arm-templates/network-VNet">https://github.com/cooperlutz/cooperscloud/tree/master/arm-templates/network-VNet</a></p>

<p> </p>
<h4>Deploy to Azure</h4>
<p>Click the Blue “Deploy to Azure button” provided in the GitHub link.</p>

<p><img src="/cooperlutz.github.io/assets/img/deploytoAzure.png" alt="image alt text" /></p>

<p> </p>
<h4>Configure Settings</h4>
<ul>
 	<li>Directory and Subscription should refer to your Azure account information. This will be auto-populated since you're already logged in.</li>
 	<li>Resource Group - you may choose to use an existing Resource Group, or "Create New"  and provide a "Resource Group Name" if you don't already have one in your subscription.</li>
 	<li>Virtual Network name - this is auto-populated using then "Default Value" in our template, seen here:</li>
</ul>
<p><img src="/cooperlutz.github.io/assets/img/defaultvalue.png" alt="image alt text" /></p>

<p> </p>

<p>After filling out the settings, click “Next”</p>

<p><img src="/cooperlutz.github.io/assets/img/VNetTemplateDeploy1.png" alt="image alt text" /></p>

<p> </p>
<h4>Click Deploy</h4>
<p><img src="/cooperlutz.github.io/assets/img/VNetTemplateDeploy2.png" alt="image alt text" /></p>

<p> </p>
<h4>Deployment Complete</h4>
<p>After the deployment has completed, click the “Manage” link or open your Azure Portal.</p>

<p><img src="/cooperlutz.github.io/assets/img/VNetTemplateDeploy3.png" alt="image alt text" /></p>

<p> </p>
<h4>Review Deployment in Azure Portal</h4>
<p>Our Virtual Network has successfully been deployed to Azure. It contains the two subnets that our template defined, along with the proper network address spaces.</p>

<p><img src="/cooperlutz.github.io/assets/img/VNetTemplateDeployFinal.png" alt="image alt text" /></p>

<p><img src="/cooperlutz.github.io/assets/img/VNetTemplateDeploySubnets.png" alt="image alt text" /></p>

        <a class="button" href="/cooperlutz.github.io/2018/04/03/mastering-arm-templates-1.html">
          Continue reading
        </a>
      </div>
    </div>
    
    <div class="post-teaser">
      <header>
        <h1>
          <a class="post-link" href="/cooperlutz.github.io/2018/03/14/cortana-and-azure.html">
            Cortana Skills and Azure
          </a>
        </h1>
        <p class="meta">
          March 14, 2018
        </p>
      </header>
      <div class="excerpt">
        <p>I received a “virtual assistant” as a gift this year and while I enjoy listening to music and quickly checking the weather forecast (spoiler: its always cold in Chicago), I love the idea of bringing the virtual assistant into the workplace. This week I decided to build learn more about building custom “Skills” and decided to put this to the test with Cortana and Azure administration.</p>

<p>I quickly came across the <a href="https://developer.microsoft.com/en-us/cortana">Cortana Dev Center</a>, which provides an easy to use language and tool-set to develop Cortana skills. Rather than using C# or other programming language, Cortana Dev Center Skills are programmed using Semantic Composition Language (SCL). This is a great introductory programming language because its easy to read and understand.</p>

<p>Here’s a quick high-level architecture of what we’ll be deploying:</p>

<p><img class="alignnone wp-image-229" src="/assets/img/CortanaDiagram.png" alt="" width="584" height="419" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>
<h2>The Scenario</h2>
<p>As someone who spends most of my days living inside the Azure portal, I thought it would be great if I could delegate some of my tasks to Cortana. I figured it would be cool if I could just ask Cortana to “fix this error”, but decided to set my sights a little lower…</p>

<p>So I imagined myself in the middle of lunch and receiving an email that I need to restart a VM ASAP. I pictured myself running to my computer, logging into Azure, finding the VM, performing a restart, confirming the machine comes back up, and then moving on, fairly simple process that takes maybe 5-10 minutes out of my lunch? But what if I could do it in 10 seconds…..</p>

<p> </p>
<h2>Create a Cortana Skill to Restart an Azure VM</h2>
<h4>Create a new Cortana Botlet</h4>
<p>Start by signing into the <a href="https://developer.microsoft.com/en-us/cortana">Cortana Dev Center</a> and create a new Cortana Skill. Follow the steps provided and fill out the information requested.</p>

<p><img class="alignnone wp-image-226" src="/assets/img/SkillStep1.png" alt="" width="480" height="309" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p><img class="alignnone wp-image-227" src="/assets/img/SkillStep2.png" alt="" width="480" height="401" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p><img class="alignnone wp-image-228" src="/assets/img/SkillStep3.png" alt="" width="480" height="451" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>
<h4>Add the Botlet code</h4>
<p>Add the Code that will control the Skill. The code I created can be found here:</p>

<p><a href="https://github.com/cooperlutz/cooperscloud/blob/master/cortana-scl/botlet.txt">https://github.com/cooperlutz/cooperscloud/blob/master/cortana-scl/botlet.txt</a></p>

<p> </p>
<h4>Add a new Runbook to your Azure Automation Account</h4>
<p>Add a new Runbook to your Automation Account</p>

<p><img class="alignnone wp-image-213" src="/assets/img/CreateRunbook-1.png" alt="" width="574" height="301" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p>Paste the Runbook code from here:</p>

<p><a href="https://github.com/cooperlutz/cooperscloud/blob/master/powershell-scripts/WebhookRunbook.ps1">https://github.com/cooperlutz/cooperscloud/blob/master/powershell-scripts/WebhookRunbook.ps1</a></p>

<p> </p>
<h4>Create the Runbook Webhook</h4>
<p>From within the Runbook, navigate to the Webhook and Create a New webhook. Give your webhook a name, and expiration. The URL will be autogenerated.</p>

<p><img class="alignnone wp-image-214" src="/assets/img/RunbookWebhook.png" alt="" width="577" height="524" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>
<h4>Add a new botlet service</h4>
<p>Add a new service to the botlet solution</p>

<p><img class="alignnone wp-image-219" src="/assets/img/CortanaService1.png" alt="" width="480" height="468" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>

<p>Add a description to the service and an image if desired</p>

<p><img class="alignnone wp-image-215" src="/assets/img/CortanaService2.png" alt="" width="480" height="397" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>

<p>Choose the “I have a web service” option, and paste the Runbook Webhook URL. You’ll need to remove the “?token=asdf….” portion, but make sure you save that portion for the next step.</p>

<p><img class="alignnone wp-image-216" src="/assets/img/CortanaService3.png" alt="" width="480" height="431" />
<img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>

<p>Update the Webhook URL to include the “?token=asdf1234…..”</p>

<p><img src="/cooperlutz.github.io/assets/img/UpdateWebhook1.png" alt="image alt text" /></p>

<p> </p>

<p>Add an action to the Service.</p>

<p><img class="alignnone size-full wp-image-221" src="/assets/img/CortanaServiceAction.png" alt="" width="2152" height="360" />
<img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>

<p>Add the Action Parameters, in this case, VM name.</p>

<p><img class="alignnone size-full wp-image-222" src="/assets/img/CortanaActionParam.png" alt="" width="2164" height="719" />
<img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>

<p>Test the solution by chatting with Cortana.</p>

<p><img class="alignnone wp-image-223" src="/assets/img/CortanaChat.png" alt="" width="644" height="755" />
<img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>

<p>Sorry something went wrong? I spent about 20 minutes chasing this error before I realized that the Runbook was in fact executing and I seemed to be receiving a false positive. I believe the error was due to the Webhook not sending a result back.</p>

<p>Here we see the output of our Runbook</p>

<p><img class="alignnone size-full wp-image-224" src="/assets/img/RunbookOutput.png" alt="" width="1284" height="568" />
<img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>

<p>Success!</p>

<p><img class="alignnone size-full wp-image-225" src="/assets/img/SUCCESS.png" alt="" width="1041" height="52" />
<img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>
<h2>Next Steps</h2>
<p>Azure <a href="https://azure.microsoft.com/en-us/services/bot-service/">Bot Services</a> resources are available to deploy more robust chat bots as an Azure Web App or Azure Function.</p>

        <a class="button" href="/cooperlutz.github.io/2018/03/14/cortana-and-azure.html">
          Continue reading
        </a>
      </div>
    </div>
    
    <div class="post-teaser">
      <header>
        <h1>
          <a class="post-link" href="/cooperlutz.github.io/2018/03/05/azure-hybrid-workers.html">
            Azure Hybrid Runbook Workers are Awesome
          </a>
        </h1>
        <p class="meta">
          March 5, 2018
        </p>
      </header>
      <div class="excerpt">
        <p>Azure Hybrid Runbook Workers enable Azure Automation Runbooks to run in a local context (OS/Server level). The Hybrid Runbook Worker’s functionality is achieved through a combination of Azure Log Analytics, Microsoft Monitoring Agent, and Azure Automation Runbooks.</p>

<p><img src="/cooperlutz.github.io/assets/img/HybridWorkerDiagram-1.png" alt="image alt text" /></p>

<h2>Why Are Hybrid Runbook Workers Awesome?</h2>
<p>Central Management of Scripts - store all automation scripts needed across the environment, in one location.</p>

<p>Hybrid Architecture - Hybrid Runbook Workers are achieved with a mix of serverless / server architectures.</p>

<p>OS Agnostic - works on Windows or Linux with Python / PowerShell Runbooks.</p>

<p>Runbook Execution - execute local scripts via Runbook Schedules, Webhooks, or Logic Apps.</p>

<p>Scalable - a Hybrid Worker Group can contain one or more VM, and an Automation Account can contain one or more Worker Group.</p>

<p>Cost Effective - smaller VM sizes can be utilized to keep costs low, I generally use a Standard_DS2_v2. Depending on your needs, the VM can be auto-shutdown to around scheduled Runbook tasks.</p>

<p>Watcher Tasks - create custom scripts to monitor services, files, tasks, etc.</p>

<p> </p>
<h2>Test Scenario</h2>
<p>Now we’ll put this to the test. For the test scenario, we’ll configure the Hybrid Worker to restart a Windows service, Print Spooler.</p>

<p> </p>
<h4>Create a Virtual Machine</h4>
<p>First we’ll need to create a Virtual Machine to be configured as our Hybrid Runbook Worker. My personal recommendation is to use a dedicated Windows / Linux VM to run the Hybrid Worker. For this test I created a “Standard_B1s” VM.</p>

<p> </p>
<h4>Configure Log Analytics OMS Workspace</h4>
<p>If you don’t have an existing Log Analytics OMS Workspace, we’ll need to start by creating one.</p>

<p>Navigate to “Log Analytics” in the Azure portal and add a new Workspace.</p>

<p><img src="/cooperlutz.github.io/assets/img/CreateWorkspace.png" alt="image alt text" /></p>

<p> </p>

<p>We need to add the “Automation and Control” solution to our OMS Workspace. Navigate to the OMS Portal and open the Solutions Gallery.</p>

<p><img src="/cooperlutz.github.io/assets/img/OpenOMSPortal-1.png" alt="image alt text" /></p>

<p> </p>

<p>Within the OMS Solutions Gallery, select “Automation &amp; Control”.</p>

<p><img src="/cooperlutz.github.io/assets/img/SolutionsGallery.png" alt="image alt text" /></p>

<p> </p>

<p>The solution will provide a warning that the Workspace needs to be configured.</p>

<p><img src="/cooperlutz.github.io/assets/img/ConfigureWorkspace.png" alt="image alt text" /></p>

<p> </p>

<p>Specify the Azure Automation Account you will be using to run your Hybrid Worker. If you don’t already have an Automation Account, you can create a new one from here.</p>

<p><img src="/cooperlutz.github.io/assets/img/ConfigureWorkspaceAutomation.png" alt="image alt text" /></p>

<p> </p>
<h4>Configure the Hybrid Runbook Worker Server</h4>
<p>Login to your server and open up PowerShell as administrator.</p>

<p>Run the following install script to add the New-OnPremiseHybridWorker script.</p>

<p><em>Note if you are not using Windows Server 2016, you may need to install Windows Management Framework 5.0 to utilize necessary PowerShell scripts.</em></p>
<pre>Install-Script -Name New-OnPremiseHybridWorker -RequiredVersion 1.0</pre>

<p><img src="/cooperlutz.github.io/assets/img/InstallHRWModule.png" alt="image alt text" /></p>

<p> </p>

<p>Next, run the script you just installed and reference the Workspace you created earlier. You’ll be asked for a few additional parameters, which are referenced below.</p>
<pre>New-OnPremiseHybridWorker.ps1  -WorkspaceName &lt;NameOfOMSWorkspace&gt;</pre>
<p>The script will ask you to input the additional parameters needed:</p>

<p><img src="/cooperlutz.github.io/assets/img/newhybridworkerscript.png" alt="image alt text" /></p>
<h4></h4>
<p>And that’s that, the server configuration is complete!</p>

<p> </p>
<h4>Create the Runbook</h4>
<p>Create a new Runbook within your Azure Automation Account.</p>

<p><img src="/cooperlutz.github.io/assets/img/CreateRunbook.png" alt="image alt text" /></p>

<p> </p>

<p>Now we’ll add our PowerShell script that will run locally (i.e. not AzureRM modules).</p>

<p><strong>Note: if using non-standard modules, the modules must be installed on the Hybrid Worker VM before executing.</strong></p>

<p><img src="/cooperlutz.github.io/assets/img/RunbookCode.png" alt="image alt text" /></p>
<h4></h4>
<h4>Test the Solution</h4>
<p>Stop Print Spooler on the Virtual Machine.</p>

<p><img src="/cooperlutz.github.io/assets/img/SpoolerStopped.png" alt="image alt text" /></p>

<p> </p>

<p>Start your Runbook and specify that it will be run on the Hybrid Worker.</p>

<p><img src="/cooperlutz.github.io/assets/img/StartRunbook.png" alt="image alt text" /></p>

<h2>Success!</h2>
<p>After the Runbook task has completed, Print Spooler is running on the server.</p>

<p><img src="/cooperlutz.github.io/assets/img/SpoolerRunning.png" alt="image alt text" /></p>

<p> </p>
<h2>Azure Automation Watcher Tasks</h2>
<p>Now we’ll use Azure Automation Watcher Tasks to monitor the Spooler service and automatically execute the “Restart-Service” script if the service is not in a “running” state.</p>
<h4>Add a Watcher and Action Runbook</h4>
<p>Start by adding the following Runbooks to your Automation Account:</p>

<p><a href="https://github.com/cooperlutz/cooperscloud/blob/master/powershell-scripts/ServiceWatcher/Watch-Service.ps1">Watch-Service</a></p>

<p><a href="https://github.com/cooperlutz/cooperscloud/blob/master/powershell-scripts/ServiceWatcher/Process-Service.ps1">Process-Service</a></p>

<p>For this section, the scripts provided are meant to be more robust and account for the ability to run scripts against other servers in the environment. However, to fully utilize the script, we’ll need credentials with the ability to open a remote PowerShell session.</p>

<p> </p>
<h5>Side Note:</h5>
<p>Here are some other great Watcher examples provided by Microsoft to watch a folder for new files:</p>

<p><a href="https://gallery.technet.microsoft.com/scriptcenter/Watcher-runbook-that-looks-36fc82cd">https://gallery.technet.microsoft.com/scriptcenter/Watcher-runbook-that-looks-36fc82cd</a></p>

<p><a href="https://gallery.technet.microsoft.com/scriptcenter/Watcher-action-that-b4ff7cdf">https://gallery.technet.microsoft.com/scriptcenter/Watcher-action-that-b4ff7cdf</a></p>

<p> </p>
<h4>Add the Local VM Credentials to Azure Automation</h4>
<p>Navigate to the “Shared Resources” section of the Automation Account and add a new credential. For testing purposes, I’m just adding the local admin account.</p>

<p><img src="/cooperlutz.github.io/assets/img/Credentials.png" alt="image alt text" /></p>

<h4>Configure the Watcher Task</h4>
<p>Navigate to the “Watcher tasks” section within your Automation Account, and click “Add a watcher task”.</p>

<p><img src="/cooperlutz.github.io/assets/img/WatcherAdd.png" alt="image alt text" /></p>

<p> </p>

<p>Specify a name for the task and the frequency to run (1-59 in minutes). Then select the “Watch-Service” Runbook as the “Watcher” and input the service name parameter (in this case, “Spooler”) and computer name parameter (in this case, “localhost”).</p>

<p><img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="image alt text" /></p>

<p> </p>

<p>For the “Action”, select the “Process-Service” Runbook, the parameter should be left blank as the value will be passed from the Watcher task.</p>

<p><img src="/cooperlutz.github.io/assets/img/WatcherAction.png" alt="image alt text" /></p>

<p> </p>

<p>Once again, we manually stop the Spooler service and wait for our watcher task to execute.</p>

<p><img src="/cooperlutz.github.io/assets/img/WatcherOutput.png" alt="image alt text" /></p>

<p> </p>
<h2>Success!</h2>

        <a class="button" href="/cooperlutz.github.io/2018/03/05/azure-hybrid-workers.html">
          Continue reading
        </a>
      </div>
    </div>
    
    <div class="post-teaser">
      <header>
        <h1>
          <a class="post-link" href="/cooperlutz.github.io/2018/02/19/azure-automation-ipam.html">
            Azure Automation and Table Storage - Creating a Basic Azure IPAM Solution
          </a>
        </h1>
        <p class="meta">
          February 19, 2018
        </p>
      </header>
      <div class="excerpt">
        <p>I wanted to provide a basic demo of Azure Automation, Azure Storage Explorer, and the use of Storage Account Tables, because I think all three are extremely valuable to any Azure Administrator or Developer. Personally, I think its more fun to provide a working solution that fully utilizes the features rather than regurgitate information that’s already available, so I came up with this.</p>
<h3 id="the-problem">The Problem</h3>
<p>Managing, planning, and organizing address spaces within Azure can get quite cumbersome and is something that I believe could be improved upon in the portal. I find myself clicking in and out of VNets, their subnets, checking outdated spreadsheets, and trying to keep everything updated once there are too many cooks in the kitchen. I chose to build this solution in Azure Automation and store my data in a Storage Account Table. Here’s the final product:</p>

<p><img src="/cooperlutz.github.iostorageExplorerFinal.png" alt="Azure Storage Explorer" /></p>

<h3 id="the-solution">The Solution</h3>
<p>I’ve provided an Azure Automation Runbook, and Local PowerShell versions of this solution which can be found on my GitHub or PowerShell Gallery:
<a href="https://github.com/cooperlutz/cooperscloud/tree/master/powershell-scripts/Generate-AzureIPAMTable">https://github.com/cooperlutz/cooperscloud/tree/master/powershell-scripts/Generate-AzureIPAMTable</a></p>

<p><a href="https://www.powershellgallery.com/packages/Generate-AzureIPAMTable/">https://www.powershellgallery.com/packages/Generate-AzureIPAMTable/</a></p>

<h3 id="table-storage">Table Storage</h3>
<p>Storage Account Tables provide simple storage of structured datasets. The Table is made up of “entities” which each contain a “Partion” and “Row” Key. The “ParitionKey” serves as a group of “entities”, while the “RowKey”  serves as the unique identifier for the “entity”.  The “RowKey” must not be a repeated more than once in a “Partition”.</p>

<p>Tables can not be viewed in the Azure portal, but Microsoft has provided a free tool “Azure Storage Explorer”, which allows for an Azure administrator to view their tables, blobs, file shares, and queues. Azure Storage Explorer also allows you to modify, add, and delete data stored in a Storage Account.</p>

<p>I like to think of them as a mix between a database table and a spreadsheet.</p>

<h2 id="the-script">The Script</h2>
<p>I wrote this script in a local PowerShell instance and then converted it to Azure Automation, my preferred method because its generally a little bit easier to troubleshoot and allows me to run portions of code rather than troubleshooting the entire script in the Azure Automation Test Pane.</p>

<p>I started by defining the resources I wanted to display in this solution:</p>
<ul>
  <li>Virtual Networks</li>
  <li>Subnets</li>
  <li>Public IPs</li>
  <li>Reserved Address Spaces - something that Azure does not provide a solution for, but I think would be a nice to have. I think of this as a placeholder for a planned space, or defining my on premises address range.</li>
</ul>

<p>From here I was able to come up with a script that would loop through all of the Public IPs, Virtual Networks, their Subnets, and then added a test output for the Reserved Spaces.</p>

<p>I decided I also wanted to add functionality that would calculate my hosts, host IP, broadcast IP, and separate out the address length. This was accomplished utilizing the PSipcalc script created by <a href="https://www.powershelladmin.com/wiki/File:PSipcalc.ps1.txt">Svedsen Tech</a>, which I added in as a Function. Big thanks to him for that piece of art. His script also provides some features that I’d love to implement at a later version, specifically around calculating and displaying any address overlap.</p>

<p>Outputting the data was tricky and something I had to try out a few times. I wanted to be able to quickly organize my output table by the “RowKey” in a fashion that would first show the VNet, then its Subnets immediately following. I accomplished this by iterating through the Vnets and assigning them a “RowKey” of “Vnet###”, and then iterating through each Subnet and assigning them a “RowKey” of “VNet###” + “Subnet###”. Now I’m able to view the data in a more understandable way by sorting by “RowKey” descending.</p>

<p>Here’s a small subset of the code to display some the data retrieval, “RowKey” iteration, PSipcalc function calls, and output:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">\#</span> <span class="nx">Get</span> <span class="nx">the</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">PIPs</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">VNets</span>
<span class="nx">$table</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">AzureStorageTable</span> <span class="o">-</span><span class="nx">Name</span> <span class="nx">$tableName</span> <span class="o">-</span><span class="nx">Context</span> <span class="nx">$saContext</span>
<span class="nx">$vnets</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">AzureRmVirtualNetwork</span>
<span class="nx">$publicIPs</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">AzureRmPublicIpAddress</span> <span class="o">-</span><span class="nx">ErrorAction</span> <span class="nx">SilentlyContinue</span>


<span class="err">\#</span> <span class="nx">Vnets</span> <span class="nx">loop</span> <span class="o">-</span> <span class="kd">get</span> <span class="nx">the</span> <span class="nx">Vnet</span> <span class="nx">data</span> <span class="nx">and</span> <span class="nx">its</span> <span class="nx">relevant</span> <span class="nx">subnets</span><span class="p">.</span>
<span class="nx">Write</span><span class="o">-</span><span class="nx">Verbose</span> <span class="dl">"</span><span class="s2">Populating VNets and Subnets...</span><span class="dl">"</span>
<span class="nx">foreach</span> <span class="p">(</span><span class="nx">$vnet</span> <span class="k">in</span> <span class="nx">$vnets</span><span class="p">)</span> <span class="p">{</span>
 
 <span class="err">\#</span> <span class="nb">Set</span> <span class="nx">Val2</span> <span class="nx">to</span> <span class="mi">1</span> <span class="nx">to</span> <span class="nx">re</span><span class="o">-</span><span class="nx">initiate</span> <span class="nx">the</span> <span class="nx">subnet</span> <span class="nx">rowkey</span>
 <span class="nx">$val2</span> <span class="o">=</span> <span class="mi">1</span>
 <span class="err">\##</span> <span class="nx">Get</span> <span class="nx">the</span> <span class="nx">Virtual</span> <span class="nx">Network</span><span class="dl">'</span><span class="s1">s range and run it through PSipcalc
 $vnetAddressSpace = Get-AzureRmVirtualNetwork -Name $vnet.Name -ResourceGroupName $vnet.ResourceGroupName | select AddressSpace
 $vnetAddressSpace = $vnetAddressSpace.AddressSpace.AddressPrefixes
 $rangeInfo = Psipcalc -NetworkAddress $vnetAddressSpace

</span><span class="se">\</span><span class="s1"># Add the table row for the Vnet
 Add-StorageTableRow -table $table -partitionKey "VNet" -rowKey ("Vnet" + ("{0:d3}" -f $val++)) -property @{`
 "VirtualNetwork" = $($vnet.Name); `
 "Type" = "Range"; `
 "Name" = $($vnet.Name); `
 "PublicIpAllocationMethod" = "";`
 "NetworkLength" = $($rangeInfo.NetworkLength);`
 "IP" = $($rangeInfo.IP);`
 "TotalHosts" = $($rangeInfo.TotalHosts);`
 "Broadcast" = $($rangeInfo.Broadcast); `
 "AddressSpace" = $($vnetAddressSpace); `
 "ResourceGroupName" = $($vnet.ResourceGroupName)`
 }

</span><span class="se">\</span><span class="s1"># Loop through all subnets within a vnet and output these to a table row
 $subnets = Get-AzureRmVirtualNetwork -Name $vnet.Name -ResourceGroupName $vnet.ResourceGroupName | select subnets
 $subnetCount = $subnets.Subnets.Name.Count
 For ($i = 0; $i -lt $subnetCount; $i++) {
 
 $rangeInfo = Psipcalc -NetworkAddress $subnets.Subnets</span><span class="se">\</span><span class="s1">[$i</span><span class="se">\</span><span class="s1">].AddressPrefix

</span><span class="se">\</span><span class="s1"># Add the table row for each vnet
 Add-StorageTableRow -table $table -partitionKey "Subnet" -rowKey ("Vnet" + ("{0:d3}" -f ($val-1)) + "Subnet" + ("{0:d3}" -f $val2++)) -property @{`
 "VirtualNetwork" = $($vnet.Name); `
 "Type" = "Range"; `
 "Name" = $($subnets.Subnets</span><span class="se">\</span><span class="s1">[$i</span><span class="se">\</span><span class="s1">].Name); `
 "PublicIpAllocationMethod" = "";`
 "NetworkLength" = $($rangeInfo.NetworkLength);`
 "IP" = $($rangeInfo.IP); `
 "TotalHosts" = $($rangeInfo.TotalHosts); `
 "Broadcast" = $($rangeInfo.Broadcast);`
 "AddressSpace" = $($subnets.Subnets</span><span class="se">\</span><span class="s1">[$i</span><span class="se">\</span><span class="s1">].AddressPrefix); `
 "ResourceGroupName" = $($vnet.ResourceGroupName)`
 }
 }
}</span></code></pre></figure>

<h2 id="azure-automation-and-storage-account-table-walk-through">Azure Automation and Storage Account Table Walk Through</h2>
<h3 id="creating-the-storage-account">Creating the Storage Account</h3>
<p>I generally like to recommend that an organization establish a general purpose Storage Account to be used for shared resources that Azure uses to integrate some of their services, like Azure Cloud Shell, Azure ARM Templates archives, or other resources that Azure admins regularly use. In this case we will establish a general purpose Storage Account that will store our Table Storage output.</p>

<p>I choose LRS for these general purpose Storage Accounts because I’m not too concerned about losing the data or not being able to access it during an Azure outage.</p>

<p><img src="/cooperlutz.github.io/assets/img/createStorageAccount.png" alt="create storage account" /></p>

<p>That’s it! Our Storage Account is ready to be used.</p>

<h3 id="configuring-the-azure-automation-account">Configuring the Azure Automation Account</h3>
<p>Start by searching for the Automation Account blade in Azure.</p>

<p><img src="/cooperlutz.github.io/assets/img/NewAutomationAccount.png" alt="create automation account" /></p>

<p>Click to add a new automation account.</p>

<p><img src="/cooperlutz.github.io/assets/img/ClickNew.png" alt="click new" /></p>

<h4 id="add-automation-account">Add Automation Account</h4>
<p>Create Azure Run As account - I choose “Yes” to this feature as my automation account deployment will generate an AzureAD account that will have Contributor access to my Azure resources. You can navigate to the “Run as accounts” under your Automation Account’s “Account Settings” to view its generated display name, Application ID, and Roles, and other relevant information. It is possible to modify the level of access this account has after it is generated.</p>

<p><img src="/cooperlutz.github.io/assets/img/addAutomationAccount.png" alt="add Automation Account" /></p>

<h4 id="updating-modules">Updating Modules</h4>
<p>Start by viewing the default PowerShell Modules added to the Automation Account. The default modules are very early versions, so we want to update these to latest. The “Update Azure Modules” button at the top will quickly update all Modules to latest.</p>

<p><img src="/cooperlutz.github.io/assets/img/modules.png" alt="add Automation Account modules" /></p>

<h4 id="adding-modules">Adding Modules</h4>
<p>Once our modules are updated, we need to add a few from the gallery for the runbook we are about to deploy. Navigate to the gallery and search for the needed modules</p>

<p>AzureRmStorageTable</p>

<p>AzureRM.Network</p>

<p><img src="/cooperlutz.github.io/assets/img/moduleSearch.png" alt="modules search" /></p>

<p>Click OK to add the module to your Automation Account.</p>

<p><img src="/cooperlutz.github.io/assets/img/addModule.png" alt="add module" /></p>

<h4 id="handling-module-dependency-issues">Handling Module Dependency Issues</h4>
<p>Upon imporing the “AzureRM.Network” module, I’ve ran into a dependency issue with “AzureRM.Profile”. Although I updated all of my Azure modules, I ended up with 4.2.0. I’ve found the best way to combat this is with the following method:</p>

<p><img src="/cooperlutz.github.io/assets/img/dependencyError.png" alt="dependency error" /></p>

<p>From the Modules blade, click on the “AzureRM.Profile” module, and then choose to delete it.</p>

<p><img src="/cooperlutz.github.io/assets/img/deleteProfile42.png" alt="delete profile" /></p>

<p>Once deleted, the module version will default back to the lowest version.</p>

<p><img src="/cooperlutz.github.io/assets/img/Profile103.png" alt="profile 103" /></p>

<p>Navigate to the online <a href="https://www.powershellgallery.com">PowerShell Gallery</a>, search for the needed module, and select it.</p>

<p><img src="/cooperlutz.github.io/assets/img/psGallery43.png" alt="aps gallery 43" /></p>

<p>Click the “Deploy to Azure Automation” button.</p>

<p><img src="/cooperlutz.github.io/assets/img/deployProfileAA.png" alt="deploy profile aa" /></p>

<p>Select your Automation Account and click OK.</p>

<p><img src="/cooperlutz.github.io/assets/img/selectAAaccount.png" alt="select aa account" /></p>

<p>Once the import has completed, return to the Automation Account and check the “Modules” blade, the AzureRM.Profile version should now show as 4.3.0.</p>

<p><img src="/cooperlutz.github.io/assets/img/profilemodule43.png" alt="profile module 43" /></p>

<p>Now we can return to the gallery and attempt to import the AzureRM.Network Module. This time we are not met with any dependency warning. Click OK to import the modules.</p>

<p><img src="/cooperlutz.github.io/assets/img/networkNoIssue.png" alt="network no issue" /></p>

<h3 id="deploying-the-runbook">Deploying the Runbook</h3>
<p>Navigate to the <a href="https://www.powershellgallery.com/packages/Generate-AzureIPAMTable/">PowerShell Gallery where the script is hosted.</a> Click the “Deploy to Azure Automation” button to add it to your Automation Account.</p>

<p>Select your Automation Account and click OK.</p>

<p><img src="/cooperlutz.github.io/assets/img/deployGenerateScript.png" alt="deploy generate script" /></p>

<p>Navigate back to your Azure Automation Account and select “Runbooks”. We see that the “Generate-AzureIPAMTable” runbook has been added. Select the runbook.</p>

<p><img src="/cooperlutz.github.io/assets/img/runbooksGenerateAdded.png" alt="runbooks generated added" /></p>

<p>From here we can make edits to the code, delete the runbook, add a schedule to automatically run our script, or review past executions. First we will click “Edit” and then choose “Publish” to make the Runbook available for execution.</p>

<p><img src="/cooperlutz.github.io/assets/img/selectRunbook.png" alt="select runbook" /></p>

<p>After publishing, we can run the script for the first time. Click “Start” to execute the script.</p>

<p><img src="/cooperlutz.github.io/assets/img/runRunbook.png" alt="run runbook" /></p>

<p>Enter the resource group of the storage account, and the storage account name, then click OK.</p>

<p><img src="/cooperlutz.github.io/assets/img/runbookParamsz.png" alt="runbook params" /></p>

<p>We can click on the “Output” to view the running details of the script.</p>

<p><img src="/cooperlutz.github.io/assets/img/runbookOutput.png" alt="runbook output" /></p>

<p>Once completed we will move on to viewing our Table’s data.</p>

<h4 id="viewing-the-storage-table">Viewing the Storage Table</h4>
<p>Download <a href="https://azure.microsoft.com/en-us/features/storage-explorer/">Storage Explorer</a> from Microsoft</p>

<p>Connect to your Storage Account either by logging into Azure or providing the Storage Account name and key.</p>

<p><img src="/cooperlutz.github.io/assets/img/StorageExplorer.png" alt="storage explorer" />
<img src="/cooperlutz.github.io/assets/img/storageAccountkeey.png" alt="storage account key" /></p>

<p>Once connected, we see our table has been generated with our Azure IP resources.</p>

<p><img src="/cooperlutz.github.io/assets/img/storageExplorerTableview.png" alt="table view" /></p>

<p>You can change the column options to make things a little friendlier.</p>

<p><img src="/cooperlutz.github.io/assets/img/columnOptionsStorageExplorer.png" alt="column options sorted" /></p>

<h3 id="complete">Complete!</h3>

        <a class="button" href="/cooperlutz.github.io/2018/02/19/azure-automation-ipam.html">
          Continue reading
        </a>
      </div>
    </div>
    
    <div class="post-teaser">
      <header>
        <h1>
          <a class="post-link" href="/cooperlutz.github.io/2018/02/10/point-to-site-vpn.html">
            Certificate Challenges with Multiple Point-to-Site VPN Gateways
          </a>
        </h1>
        <p class="meta">
          February 10, 2018
        </p>
      </header>
      <div class="excerpt">
        <p>I ran into an extremely common issue with a Point-to-Site configuration with a not so common resolution. The Point-to-Site <a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal">configuration guide provided by Microsoft</a> is pretty easy to follow. Microsoft provides specific instructions and recommendations and I’ve followed this guide on numerous occasions.</p>

<p><img src="/cooperlutz.github.io/assets/img/MultiP2SDiagram.png" alt="Multi P2S Diagram" /></p>

<p>In this particular instance, I needed to configure a Point-to-Site connections between two separate VPN Gateways, all existing in the same subscription/region.</p>

<p>I created a Root and Client certificate using <a href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-certificates-point-to-site">PowerShell</a> and uploaded the Base-64 .cer from my Root certificate to both of my test VPN Gateways. Copy and pasting directly from Notepad as most of us generally do:</p>

<p><img src="/cooperlutz.github.io/assets/img/CertificateNotepad.png" alt="Cert Notepad" /></p>

<p>The certificate uploaded to both of my “test” gateways and I was able to configure the Point-to-Site connections from both of these gateways.</p>

<h3 id="the-problem">The Problem</h3>
<p>Production deployment was the next step. Everything was going just fine until it came to testing the connections. I had already uploaded the certificate, set my address space, and downloaded the client for both gateways. I was able to connect to “Gateway01” just fine, but I received an error when trying to connect to “Gateway02”.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">A</span> <span class="nx">certificate</span> <span class="nx">could</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">found</span> <span class="nx">that</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">used</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">Extensible</span> <span class="nx">Authentication</span> <span class="nx">Protocol</span><span class="p">.</span> <span class="p">(</span><span class="nb">Error</span> <span class="mi">798</span><span class="p">)</span></code></pre></figure>

<p>This issue usually results from not creating your certificates correctly or not having them installed to the correct certificate store (they need to be located in the Personal store as opposed to the Computer). I was a little unsure about this instance because “Gateway01” was using the same exact Root and Client certificate, and I already had my connection in place. Either way, I went ahead and recreated my Root and Client certificates, uploaded them to both of my gateways, and re-downloaded the VPN client. Tried connecting to my gateways and…..</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">A</span> <span class="nx">certificate</span> <span class="nx">could</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">found</span> <span class="nx">that</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">used</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">Extensible</span> <span class="nx">Authentication</span> <span class="nx">Protocol</span><span class="p">.</span> <span class="p">(</span><span class="nb">Error</span> <span class="mi">798</span><span class="p">)</span></code></pre></figure>

<p>Ok, well this was frustrating. So based on the error I received I was confident that the Root certificate had to be the issue. I wondered if it was something about the way the certificate was pasted within the Point-to-Site configuration. What if that “Enter” character that copied over from the Base-64 .cer file was pasting incorrectly into my P2S certificate line. I tested this theory out by reformatting my certificate to look a little something like this, making sure not to include the “BEGIN” and “END” sections of course:</p>

<p><img src="/cooperlutz.github.io/assets/img/CertificateOneLine.png" alt="Cert One Line" /></p>

<p>So essentially I was uploading the certificate without any spaces or strange “Enter” characters that could have been copied over from the generic certificate format. I went to re-upload the certificate to my “Gateway02” P2S configuration and sure enough I was met with an error:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Operation</span> <span class="nx">name</span>
<span class="nx">Write</span> <span class="nx">VirtualNetworkGateways</span>
<span class="nx">Time</span> <span class="nx">stamp</span>
<span class="nx">Event</span> <span class="nx">initiated</span> <span class="nx">by</span>
<span class="nb">Error</span> <span class="nx">code</span>
<span class="nx">VirtualNetworkGatewayDuplicateVpnclientRootCertificate</span>
<span class="nx">Message</span>
<span class="nx">Virtual</span> <span class="nx">Network</span> <span class="nx">Gateway</span> <span class="o">/</span><span class="nx">subscriptions</span><span class="o">/</span><span class="nx">SubscriptionId</span><span class="o">/</span><span class="nx">resourceGroups</span><span class="o">/</span><span class="nx">ResourceGroupName</span><span class="o">/</span><span class="nx">providers</span><span class="o">/</span>
<span class="nx">Microsoft</span><span class="p">.</span><span class="nx">Network</span><span class="o">/</span><span class="nx">virtualNetworkGateways</span><span class="o">/</span><span class="nx">VPNGateway02</span>
<span class="nx">cannot</span> <span class="nx">have</span> <span class="nx">same</span> <span class="nx">certificate</span> <span class="nx">used</span> <span class="nx">across</span> <span class="nx">two</span> <span class="nx">vpnclient</span> <span class="nx">root</span> <span class="nx">Certificate</span> <span class="nx">elements</span><span class="p">.</span> <span class="nx">Certificate</span> <span class="k">for</span>
<span class="sr">/subscriptions/</span><span class="nx">SubscriptionId</span><span class="o">/</span><span class="nx">resourceGroups</span><span class="o">/</span><span class="nx">ResourceGroupName</span><span class="o">/</span><span class="nx">providers</span><span class="o">/</span><span class="nx">Microsoft</span><span class="p">.</span><span class="nx">Network</span><span class="o">/</span>
<span class="nx">virtualNetworkGateways</span><span class="o">/</span><span class="nx">VPNGateway01</span><span class="o">/</span><span class="nx">vpnClientRootCertificates</span><span class="o">/</span><span class="nx">CertName</span> <span class="nx">and</span>
<span class="o">/</span><span class="nx">subscriptions</span><span class="o">/</span><span class="nx">SubscriptionId</span><span class="o">/</span><span class="nx">resourceGroups</span><span class="o">/</span><span class="nx">ResourceGroupName</span><span class="o">/</span><span class="nx">providers</span><span class="o">/</span><span class="nx">Microsoft</span><span class="p">.</span><span class="nx">Network</span><span class="o">/</span>
<span class="nx">virtualNetworkGateways</span><span class="o">/</span><span class="nx">VPNGateway02</span><span class="o">/</span><span class="nx">vpnClientRootCertificates</span><span class="o">/</span><span class="nx">CertName</span> <span class="nx">are</span> <span class="nx">same</span><span class="p">.</span></code></pre></figure>

<p>How strange that Azure hadn’t caught this based off the way I had been copy/pasting the certificate previously. And what about my test gateways that successfully used the same Root certificate? Possibly just a fluke? Maybe my copy/paste skills are lacking? Whatever the case may be, I was excited that I found an error and decided to just create separate Root certificates for each VPN Gateway. Both connections fired right up.</p>

<h2 id="key-takeaway">Key Takeaway:</h2>
<p>Always create separate root certificates when creating more than one Point-to-Site Gateway.</p>

        <a class="button" href="/cooperlutz.github.io/2018/02/10/point-to-site-vpn.html">
          Continue reading
        </a>
      </div>
    </div>
    
  </div>

  
  <div class="pagination">
    
    <a href="/cooperlutz.github.io/" class="button" >
      <i class="fa fa-chevron-left"></i>
      Prev
    </a>
    
    
  </div>
  
</div>

    </div>
    


<footer class="site-footer">
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/rohanchandra/type-theme">Type Theme</a>
</p>
</footer>


  </body>
</html>
